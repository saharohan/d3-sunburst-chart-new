!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).sunburst=t()}}(function(){return function o(s,u,a){function l(e,t){if(!u[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(p)return p(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var r=u[e]={exports:{}};s[e][0].call(r.exports,function(t){return l(s[e][1][t]||t)},r,r.exports,o,s,u,a)}return u[e].exports}for(var p="function"==typeof require&&require,t=0;t<a.length;t++)l(a[t]);return l}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),r=f(t("react")),o=f(t("prop-types")),s=f(t("shallowequal")),p=t("d3-color"),a=t("d3-selection"),u=t("d3-scale"),l=t("d3-hierarchy"),d=t("d3-shape"),c=t("d3-path"),h=t("d3-interpolate");function f(t){return t&&t.__esModule?t:{default:t}}t("d3-transition").transition;var _=function(t){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e._last_click=null,e.radius=Math.min(e.props.width,e.props.height)/2,e.y=(0,u.scaleSqrt)().range([0,e.radius]),e.x=(0,u.scaleLinear)().range([0,2*Math.PI]),e.arc=(0,d.arc)().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,e.x(t.x0)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,e.x(t.x1)))}).innerRadius(function(t){return Math.max(0,e.y(t.y0))}).outerRadius(function(t){return Math.max(0,e.y(t.y1))}),e.partition=(0,l.partition)(),e.hueDXScale=(0,u.scaleLinear)().domain([0,1]).range([0,360]),e.domId=e.props.domId||"sunburst-wrapper-"+Math.round(1e12*Math.random()).toString(),e.svg=null,e.tooltipDom=null,e.lastSelect=null,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,r.default.Component),i(n,[{key:"componentDidMount",value:function(){this.props._debug&&this.props._log("Sunburst: componentDidMount()"),this._create()}},{key:"shouldComponentUpdate",value:function(t){return this.props._debug&&this.props._log("Sunburst: shouldComponentUpdate()",this.props),!!(0,s.default)(this.props,t)}},{key:"_destroy_svg",value:function(){this.props._debug&&this.props._log("Sunburst: _destroy_svg()"),this.svg&&this.svg.selectAll("*").remove(),this.svg=null}},{key:"componentDidUpdate",value:function(){this.props._debug&&this.props._log("Sunburst: componentDidUpdate()"),this._destroy_svg(),this._create()}},{key:"componentWillUnmount",value:function(){this.props._debug&&this.props._log("Sunburst: componentWillUnmount()"),this._destroy_svg()}},{key:"select",value:function(t){this.props._debug&&this.props._log("Sunburst: select(id)");var e="#mainArc-"+t,n=(0,a.select)(e).nodes();if(n.length){var i=n[0].__data__;this._update(i)}else this.props._warn("could not find node with id of "+e)}},{key:"_onClick",value:function(t){this.props._debug&&this.props._log("Sunburst: _onClick(node)"),this._last_click=t}},{key:"updateColor",value:function(){var e=this;this.props._debug&&this.props._log("Sunburst: updateColor()"),this.svg.selectAll("path.sunburst-main-arc").style("fill",function(t){return t.parent?e._colorize(t):"white"})}},{key:"_create",value:function(){var e=this;if(this.props._debug&&this.props._log("Sunburst: _create()"),this.props.data){var t=(0,l.hierarchy)(this.props.data).sum(function(t){return void 0===t[this.props.count_member]&&this.props._warn("props.count_member ("+this.props.count_member+") is not defined on data"),t.children&&0!==t.children.length?0:t[this.props.count_member]}.bind(this)),n=this.partition(t).descendants().filter(function(t){return t.x1-t.x0>e.props.radianCutoff});if(!this.svg){var i=this.props.width,r=this.props.height,o=(0,a.select)("#"+this.domId);this.svg=o.append("svg"),this.svg.style("class","sunburst-svg").style("width",i+"px").style("height",r+"px").attr("viewBox",-i/2+" "+-r/2+" "+i+" "+r);var s=this.svg.selectAll("g").data(n).enter().append("g");s.exit().remove();var u=this.props.key_member;if(s.append("path").attr("class",function(t){return"sunburst-main-arc"+(t.parent&&t.children," cursor-pointer")+" "+(t.depth%2?"even-row":"odd-row")}).attr("id",function(t,e){return u?"mainArc-"+t.data[u]:"mainArc-"+e}).style("fill",function(t){return t.parent?e._colorize(t):"white"}).on("click",function(t){this._onClick(t),this.props.onClick&&this.props.onClick(t),this._update(t)}.bind(this)),this.props.labelFunc)s.append("path").attr("class","sunburst-hidden-arc").attr("id",function(t,e){return"hiddenArc"+e}).attr("d",this._middleArcLine.bind(this)).style("fill","none"),s.append("text").style("pointer-events","none").style("dominant-baseline","middle").style("text-anchor","middle").append("textPath").attr("startOffset","50%").attr("xlink:href",function(t,e){return"#hiddenArc"+e}).text(function(t){return e._getLabelText(t)||""})}this.props.tooltip&&this._setTooltips(),this._update(t)}}},{key:"_update",value:function(t,e,n){var i=this;if(this.props._debug&&this.props._log("Sunburst: _update(d, i, a)"),!this.lastSelect||!n||this.lastSelect!=n[e].id){this.lastSelect=n&&n[e].id,this.svg.transition().selectAll("textPath").attr("opacity",0);var r=this.svg.transition().duration(this.props.transitionDuration).tween("scale",function(){var e=(0,h.interpolate)(this.x.domain(),[t.x0,t.x1]),n=(0,h.interpolate)(this.y.domain(),[t.y0,1]),i=(0,h.interpolate)(this.y.range(),[t.y0?20:0,this.radius]);return function(t){this.x.domain(e(t)),this.y.domain(n(t)).range(i(t))}.bind(this)}.bind(this));r.selectAll("path.sunburst-hidden-arc").attrTween("d",function(t){return function(){return i._middleArcLine(t)}}),r.selectAll("path.sunburst-main-arc").attrTween("d",function(t){return function(){return i.arc(t)}}).on("end",function(t,e,n){i.arc.innerRadius()(t)&&(0,a.select)(n[e].parentNode).select("text textPath").transition(i.props.transitionDuration/2).attr("opacity",1).text(function(t){return i._getLabelText(t)})})}}},{key:"_textFits",value:function(t,e){if(this.props._debug&&this.props._log("Sunburst: _textFits(d, label)"),!e)return!1;var n=57.296*(this.arc.endAngle()(t)-this.arc.startAngle()(t)),i=this.arc.outerRadius()(t),r=2*Math.PI*i*(n/360);return e.length*this.props.font_size<r}},{key:"_getLabelText",value:function(t){var e;return this.props._debug&&this.props._log("Sunburst: _getLabelText(d)"),e=this.props.labelFunc&&this.props.labelFunc(t),this._textFits(t,e)?e:(e=this.props.condensedLabelFunc&&this.props.condensedLabelFunc(t),this._textFits(t,e)?e:null)}},{key:"_middleArcLine",value:function(t){this.props._debug&&this.props._log("Sunburst: _middleArcLine(d)");var e=Math.PI/2,n=[this.x(t.x0)-e,this.x(t.x1)-e],i=Math.max(0,(this.y(t.y0)+this.y(t.y1))/2),r=(n[1]+n[0])/2,o=0<r&&r<Math.PI;o&&n.reverse();var s=(0,c.path)();return s.arc(0,0,i,n[0],n[1],o),s.toString()}},{key:"_inDomain",value:function(t){this.props._debug&&this.props._log("Sunburst: _inDomain(d)");var e=this.x.domain()[0],n=this.x.domain()[1];return!(t.x0<e)&&!(t.x1>n)}},{key:"_setTooltips",value:function(){this.props._debug&&this.props._.log("Sunburst: _setTooltips(d)"),this.tooltipDom=(0,a.select)("#"+this.domId).append("div").attr("class","sunburst-tooltip").style("position","absolute").style("z-index","10").style("opacity","0").style("text-align","center").style("border-radius","8px").style("pointer-events","none").style("background","lightsteelblue").style("padding","3px");var e=this.props.tooltipX,n=this.props.tooltipY;this.svg.selectAll("path.sunburst-main-arc").on("mouseover",function(t){this.props.tooltip&&(this.tooltipDom.html(this.props.tooltipFunc(t.data)).style("left",a.event.pageX+e+"px").style("top",a.event.pageY+n+"px"),this.tooltipDom.transition().style("opacity",.9).duration(200),this.props.onMouseover&&this.props.onMouseover(t.data))}.bind(this)).on("mouseout",function(t){this.props.tooltip&&this.tooltipDom.transition().style("opacity",0).duration(500),this.props.onMouseout&&this.props.onMouseout(t.data)}.bind(this))}},{key:"_colorize",value:function(t){this.props._debug&&this.props._log("Sunburst: _colorize(d)");var e=void 0,n=t;if(0===n.depth)return"#33cccc";var i=this.props,r=i.lightness,o=i.saturation,s=i.child_brightness;if(n.depth<=1)return e=this.hueDXScale(t.x0),n.fill=(0,p.hsl)(e,o,r),n.fill;n.fill=n.parent.fill.brighter(s);var u=(0,p.hsl)(n.fill);e=this.hueDXScale(n.x0);var a=u.h+e/4,l=(0,p.hsl)(a,u.s,u.l);return this.props.colorFunc||this.props.colorFunc(t,l)||l}},{key:"render",value:function(){return this.props._debug&&this.props._log("Sunburst: render()"),r.default.createElement("div",{className:"sunburst-wrapper",id:this.domId})}}]),n}();_.propTypes={data:o.default.object.isRequired,width:o.default.string.isRequired,height:o.default.string.isRequired,count_member:o.default.string.isRequired,tooltip:o.default.bool.isRequired,radianCutoff:o.default.number.isRequired,transitionDuration:o.default.number.isRequired,saturation:o.default.number.isRequired,lightness:o.default.number.isRequired,child_brightness:o.default.number.isRequired,font_size:o.default.number.isRequired,colorFunc:o.default.func,tooltipFunc:o.default.func,tooltipX:o.default.number.isRequired,tooltipY:o.default.number.isRequired,domId:o.default.string,onMouseover:o.default.func,onMouseout:o.default.func,onClick:o.default.func,labelFunc:o.default.func,condensedLabelFunc:o.default.func,key_member:o.default.string,_debug:o.default.bool,_log:o.default.func,_warn:o.default.func},_.defaultProps={tooltip:!0,tooltipFunc:function(t){return t.name},radianCutoff:.001,transitionDuration:500,colorFunc:function(t,e){return e},key_member:"key",font_size:12,tooltipX:20,tooltipY:20,saturation:.5,lightness:.5,child_brightness:.5,_debug:!1,_log:console.log,_warn:console.warn},n.default=_},{"d3-color":"d3-color","d3-hierarchy":"d3-hierarchy","d3-interpolate":"d3-interpolate","d3-path":"d3-path","d3-scale":"d3-scale","d3-selection":"d3-selection","d3-shape":"d3-shape","d3-transition":"d3-transition","prop-types":"prop-types",react:"react",shallowequal:"shallowequal"}]},{},[1])(1)});